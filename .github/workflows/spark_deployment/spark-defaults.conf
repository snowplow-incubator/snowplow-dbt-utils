# Core Infrastructure
spark.master                                   spark://spark-master:7077
spark.eventLog.enabled                         true
spark.eventLog.dir                            /tmp/spark-events

# Core Spark SQL Settings
spark.sql.extensions                          org.apache.iceberg.spark.extensions.IcebergSparkSessionExtensions
spark.sql.catalog.spark_catalog               org.apache.iceberg.spark.SparkSessionCatalog
spark.sql.catalog.spark_catalog.type          hive
spark.sql.defaultCatalog                      iceberg_catalog

# Hive and Thrift Server Settings
spark.sql.hive.metastore.version             2.3.9
spark.sql.hive.metastore.jars                builtin
spark.sql.warehouse.dir                       /tmp/spark-warehouse
spark.sql.hive.thriftServer.singleSession     true
hive.server2.thrift.port                      10000
hive.server2.thrift.bind.host                 0.0.0.0

# Memory and Performance Settings (Optimized for GitHub runner)
spark.memory.fraction                         0.6
spark.memory.storageFraction                  0.3
spark.serializer                              org.apache.spark.serializer.KryoSerializer
spark.sql.adaptive.enabled                    true
spark.sql.shuffle.partitions                  100
spark.default.parallelism                     100
spark.driver.memory                           1g
spark.executor.memory                         2g
spark.executor.cores                          1

# AWS Integration
spark.hadoop.fs.s3a.impl                      org.apache.hadoop.fs.s3a.S3AFileSystem
spark.hadoop.fs.s3a.aws.credentials.provider  com.amazonaws.auth.DefaultAWSCredentialsProviderChain
spark.hadoop.fs.s3a.endpoint                  s3.eu-west-1.amazonaws.com

# S3 Performance Settings
spark.hadoop.fs.s3a.connection.maximum        50
spark.hadoop.fs.s3a.connection.timeout        300000
spark.hadoop.fs.s3a.threads.max               10
spark.hadoop.fs.s3a.multipart.size           32M
spark.hadoop.fs.s3a.fast.upload              true
spark.hadoop.fs.s3a.fast.upload.buffer       disk
spark.hadoop.fs.s3a.path.style.access        true

# Iceberg Catalog Configuration
spark.sql.catalog.iceberg_catalog             org.apache.iceberg.spark.SparkCatalog
spark.sql.catalog.iceberg_catalog.catalog-impl org.apache.iceberg.aws.glue.GlueCatalog
spark.sql.catalog.iceberg_catalog.io-impl     org.apache.iceberg.aws.s3.S3FileIO
spark.sql.catalog.iceberg_catalog.warehouse   s3a://dbt-testing-automation/warehouse